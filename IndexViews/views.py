# -*- coding: utf-8 -*-
from __future__ import unicode_literals

from django.shortcuts import render
from django.views.generic import View
from .models import ExploitsModels

# Create your views here.
# import csv
# import time
#
# with open('files.csv') as csvfile:
#     reader = csv.DictReader(csvfile)
#     for row in reader:
#         print row
#         description, platform, filepath, date = row.get('description'), row.get('platform'), row.get('file'), row.get('date')
#         ExploitsModels.objects.create(exploitTitle=description, exploitPath=filepath, platform=platform, date=date)
def getListFromModels(keywords):
    retLists = ExploitsModels.objects.filter(exploitTitle__icontains=keywords[0])
    # retLists = [x for x in ExploitsModels.objects.filter(exploitTitle__contains=keyword)] + [y for y in ExploitsModels.objects.filter(exploitPath__contains=keyword)]
    for keyword in keywords.split('|'):
        retLists = retLists.filter(exploitTitle__icontains=keyword)
    return retLists.order_by('-date')

class Index(View):

    def get(self, request):
        keywords = request.GET['keyword'] if 'keyword' in request.GET else None
        if keywords:
            retLists = getListFromModels(keywords)
            return render(request, "index.html", {"rets": retLists, "keyword": keywords})
        return render(request, "index.html")
import os
class FileView(View):

    def get(self, request):
        keyword = request.GET['file'] if 'file' in request.GET else None
        # print keyword
        # print '.' not in keyword[:-5]
        # print len(keyword.split('/'))
        # print os.getcwd()
        # print 'IndexViews/'+keyword
        if keyword and '.' not in keyword[:-5] and len(keyword.split('/'))==4:
            with open(os.getcwd()+'/'+keyword) as f:
                r = f.read()

            return render(request, "views.html", {"title": keyword, "context": r.decode('utf-8').replace('\n','<br>')})
        return render(request, "views.html")